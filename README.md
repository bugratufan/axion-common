# Axion Common

Shared VHDL modules and utilities for use with the [Axion-HDL](https://github.com/bugratufan/axion-hdl) tool.

## Overview

This repository contains reusable VHDL components designed to integrate with AXI4-Lite register interfaces generated by Axion-HDL. While Axion-HDL generates the register map logic, `axion-common` provides the essential shared types (like `t_axi_lite_m2s`, `t_axi_lite_s2m`) and helper modules needed to instantiate and connect these interfaces in your FPGA designs.

## Components

### axion_common_pkg
Common type definitions and constants for AXI4-Lite interfaces:
- `t_axi_lite_m2s` - Master to Slave signal record
- `t_axi_lite_s2m` - Slave to Master signal record
- `t_axi_lite_m2s_array` / `t_axi_lite_s2m_array` - Array types for multiple ports
- AXI response constants (`C_AXI_RESP_OKAY`, `C_AXI_RESP_SLVERR`, etc.)

### axion_axi_lite_bridge
AXI4-Lite bridge that connects a single master to multiple slaves:
- **Generic slave count** - Configurable number of downstream slaves
- **Broadcast requests** - Forwards read/write requests to all slaves simultaneously
- **First-responder wins** - Returns the first OKAY response to master
- **Error handling** - Returns SLVERR if all slaves respond with error
- **Timeout mechanism** - Configurable timeout for unresponsive slaves

```vhdl
entity axion_axi_lite_bridge is
    generic (
        G_NUM_SLAVES     : positive := 2;      -- Number of slave ports
        G_TIMEOUT_WIDTH  : positive := 16      -- Timeout = 2^WIDTH cycles
    );
    port (
        i_clk         : in  std_logic;
        i_rst_n       : in  std_logic;
        M_AXI_M2S     : in  t_axi_lite_m2s;        -- Master port (upstream)
        M_AXI_S2M     : out t_axi_lite_s2m;
        S_AXI_ARR_M2S : out t_axi_lite_m2s_array;  -- Slave ports (downstream)
        S_AXI_ARR_S2M : in  t_axi_lite_s2m_array
    );
end entity;
```

## Directory Structure

```
axion-common/
├── src/
│   ├── axion_common_pkg.vhd      # Type definitions and constants
│   ├── axion_common.vhd          # Main VHDL wrapper
│   └── axion_axi_lite_bridge.vhd # AXI-Lite bridge module
├── tb/                           # Testbenches
│   └── axion_axi_lite_bridge_tb.vhd
└── README.md
```

## Usage

This repository is intended to be used as a Git submodule in projects that utilize Axion-HDL for register generation.

### Adding to your project

```bash
git submodule add https://github.com/bugratufan/axion-common.git axion-common
```

### Updating to latest version

```bash
git submodule update --remote axion-common
```

### Using in VHDL

```vhdl
library axion_common;
use axion_common.axion_common_pkg.all;

-- Now you can use t_axi_lite_m2s, t_axi_lite_s2m, etc.
signal axi_m2s : t_axi_lite_m2s;
signal axi_s2m : t_axi_lite_s2m;
```

## License

MIT License
